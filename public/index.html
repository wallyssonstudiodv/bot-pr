<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Disparador - Wallysson Studio Dv 2025</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --shadow: 0 10px 30px rgba(0,0,0,0.1);
            --border-radius: 15px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            background: white;
            border-radius: var(--border-radius);
            padding: 40px 30px;
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color), var(--success-color));
        }

        .header h1 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 3em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            animation: fadeInUp 0.8s ease;
        }

        .header .subtitle {
            font-size: 1.4em;
            color: var(--secondary-color);
            font-weight: 600;
            margin: 10px 0;
            animation: fadeInUp 0.8s ease 0.2s both;
        }

        .header .motto {
            font-style: italic;
            color: var(--info-color);
            margin-top: 15px;
            font-size: 1.1em;
            animation: fadeInUp 0.8s ease 0.4s both;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid rgba(0,0,0,0.05);
            position: relative;
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }

        .card h2 {
            color: var(--dark-color);
            margin-bottom: 25px;
            border-bottom: 3px solid var(--primary-color);
            padding-bottom: 15px;
            font-size: 1.4em;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-indicator {
            display: inline-flex;
            align-items: center;
            padding: 8px 16px;
            border-radius: 25px;
            color: white;
            font-weight: 600;
            margin-left: 10px;
            font-size: 0.9em;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.8; }
        }

        .status-connected {
            background: var(--success-color);
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.3);
        }

        .status-disconnected {
            background: var(--danger-color);
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.3);
        }

        .btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            margin: 5px;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            background: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .btn-danger {
            background: var(--danger-color);
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .btn-success {
            background: var(--success-color);
        }

        .btn-success:hover {
            background: #229954;
        }

        .btn-warning {
            background: var(--warning-color);
        }

        .btn-warning:hover {
            background: #d68910;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
        }

        .btn-large {
            padding: 16px 32px;
            font-size: 18px;
        }

        .qr-container {
            text-align: center;
            padding: 30px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .qr-code {
            max-width: 280px;
            border: 4px solid var(--primary-color);
            border-radius: var(--border-radius);
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            animation: qrPulse 2s ease-in-out infinite alternate;
        }

        @keyframes qrPulse {
            from { transform: scale(1); }
            to { transform: scale(1.02); }
        }

        .form-group {
            margin-bottom: 25px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
            font-size: 1.1em;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: var(--transition);
            background: #fafafa;
        }

        .form-group input:focus, .form-group select:focus {
            border-color: var(--primary-color);
            outline: none;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .groups-list {
            max-height: 350px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            background: #fafafa;
        }

        .groups-list::-webkit-scrollbar {
            width: 8px;
        }

        .groups-list::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .groups-list::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 10px;
        }

        .group-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 1px solid #eee;
            transition: var(--transition);
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .group-item:hover {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .group-item:last-child {
            border-bottom: none;
        }

        .group-item input[type="checkbox"] {
            margin-right: 15px;
            transform: scale(1.3);
            cursor: pointer;
        }

        .group-item label {
            cursor: pointer;
            flex: 1;
            font-weight: 500;
        }

        .logs-container {
            max-height: 450px;
            overflow-y: auto;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            background: #2c3e50;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }

        .logs-container::-webkit-scrollbar {
            width: 8px;
        }

        .logs-container::-webkit-scrollbar-track {
            background: #34495e;
            border-radius: 4px;
        }

        .logs-container::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 4px;
        }

        .log-entry {
            margin-bottom: 12px;
            padding: 10px;
            border-radius: 6px;
            border-left: 4px solid;
            animation: logSlideIn 0.3s ease;
        }

        @keyframes logSlideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .log-info {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
            border-left-color: #3498db;
        }

        .log-success {
            background: rgba(39, 174, 96, 0.1);
            color: #27ae60;
            border-left-color: #27ae60;
        }

        .log-warning {
            background: rgba(243, 156, 18, 0.1);
            color: #f39c12;
            border-left-color: #f39c12;
        }

        .log-error {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border-left-color: #e74c3c;
        }

        .schedule-item {
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            background: #fafafa;
            transition: var(--transition);
        }

        .schedule-item:hover {
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .schedule-item.active {
            border-color: var(--success-color);
            background: rgba(39, 174, 96, 0.05);
        }

        .schedule-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .schedule-info {
            flex: 1;
            min-width: 250px;
        }

        .schedule-info h3 {
            color: var(--dark-color);
            margin-bottom: 8px;
            font-size: 1.2em;
        }

        .schedule-info small {
            display: block;
            color: #666;
            margin-bottom: 4px;
        }

        .schedule-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .days-selector {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin: 15px 0;
        }

        .day-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            border-radius: 8px;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            transition: var(--transition);
            cursor: pointer;
        }

        .day-checkbox:hover {
            background: white;
            border-color: var(--primary-color);
        }

        .day-checkbox input:checked + label {
            color: var(--primary-color);
            font-weight: 600;
        }

        .hidden {
            display: none !important;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.3s ease;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 3% auto;
            padding: 30px;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
            line-height: 1;
        }

        .close:hover {
            color: var(--danger-color);
            transform: rotate(90deg);
        }

        .anti-ban-settings {
            background: linear-gradient(45deg, #fff3cd, #ffeaa7);
            border: 2px solid #f39c12;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .anti-ban-settings::before {
            content: 'üõ°Ô∏è';
            position: absolute;
            top: -10px;
            right: -10px;
            font-size: 60px;
            opacity: 0.1;
        }

        .anti-ban-settings h3 {
            color: var(--warning-color);
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            text-align: center;
            padding: 25px;
            border-radius: 12px;
            margin: 10px;
            box-shadow: var(--shadow);
        }

        .stats-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stats-label {
            font-size: 1em;
            opacity: 0.9;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 20px;
            background: linear-gradient(45deg, #f8f9fa, #e9ecef);
            border-radius: 12px;
            margin: 20px 0;
        }

        .status-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            animation: statusPulse 2s infinite;
        }

        .status-icon.connected {
            background: var(--success-color);
            box-shadow: 0 0 20px rgba(39, 174, 96, 0.3);
        }

        .status-icon.disconnected {
            background: var(--danger-color);
            box-shadow: 0 0 20px rgba(231, 76, 60, 0.3);
        }

        @keyframes statusPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--success-color));
            width: 0%;
            transition: width 0.3s ease;
        }

        .tooltip {
            position: relative;
            cursor: help;
        }

        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--dark-color);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            z-index: 1000;
        }

        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }

        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 2000;
            animation: toastSlideIn 0.3s ease;
        }

        .toast.error {
            background: var(--danger-color);
        }

        .toast.warning {
            background: var(--warning-color);
        }

        .toast.info {
            background: var(--info-color);
        }

        @keyframes toastSlideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsividade Melhorada */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .header h1 {
                font-size: 2.2em;
            }

            .header .subtitle {
                font-size: 1.2em;
            }
            
            .card {
                padding: 20px;
            }
            
            .btn {
                padding: 10px 16px;
                font-size: 14px;
            }

            .modal-content {
                margin: 10% auto;
                width: 95%;
                padding: 20px;
            }

            .schedule-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .schedule-actions {
                width: 100%;
                justify-content: flex-start;
            }

            .days-selector {
                gap: 10px;
            }

            .day-checkbox {
                padding: 6px 10px;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.8em;
            }

            .btn {
                padding: 8px 12px;
                font-size: 12px;
            }

            .card {
                padding: 15px;
            }

            .form-group input, .form-group select {
                padding: 10px;
            }
        }

        /* Anima√ß√µes de entrada */
        .fade-in {
            animation: fadeIn 0.6s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .slide-up {
            animation: slideUp 0.6s ease;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header Melhorado -->
        <div class="header fade-in">
            <h1>üöÄ Auto Disparador</h1>
            <p class="subtitle">Sistema Avan√ßado de Automa√ß√£o WhatsApp</p>
            <p class="motto">‚ú® <em>"Voc√™ sonha, Deus realiza"</em> ‚ú®</p>
        </div>

        <!-- Status e Conex√£o Melhorado -->
        <div class="card slide-up">
            <h2>üîó Conex√£o WhatsApp</h2>
            
            <div class="connection-status">
                <div id="statusIcon" class="status-icon disconnected"></div>
                <div>
                    <strong>Status: </strong>
                    <span id="statusText">Desconectado</span>
                </div>
                <span id="statusIndicator" class="status-indicator status-disconnected">Desconectado</span>
            </div>
            
            <div id="connectionButtons">
                <button id="connectBtn" class="btn btn-large">
                    <span>üîå</span> Conectar Bot
                </button>
                <button id="disconnectBtn" class="btn btn-danger btn-large" disabled>
                    <span>üîå</span> Desconectar
                </button>
                <button id="clearSessionBtn" class="btn btn-warning">
                    <span>üóëÔ∏è</span> Limpar Sess√£o
                </button>
            </div>

            <!-- QR Code Melhorado -->
            <div id="qrContainer" class="qr-container hidden">
                <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                    üì± Escaneie o QR Code com seu WhatsApp
                </h3>
                <img id="qrCode" class="qr-code" alt="QR Code">
                <p style="margin-top: 15px; color: #666;">
                    Abra o WhatsApp ‚Üí Menu ‚Üí Aparelhos conectados ‚Üí Conectar um aparelho
                </p>
            </div>
        </div>

        <div class="grid">
            <!-- Configura√ß√µes do YouTube Melhoradas -->
            <div class="card slide-up">
                <h2>üé• Configura√ß√µes YouTube</h2>
                <div class="form-group">
                    <label class="tooltip" data-tooltip="Sua chave da API do YouTube v3">
                        API Key do YouTube:
                    </label>
                    <input type="password" id="youtubeApiKey" placeholder="Digite sua API Key">
                </div>
                <div class="form-group">
                    <label class="tooltip" data-tooltip="ID do canal do YouTube (encontrado na URL)">
                        ID do Canal:
                    </label>
                    <input type="text" id="channelId" placeholder="Digite o ID do canal">
                </div>
                <button id="saveConfigBtn" class="btn btn-success btn-large">
                    <span>üíæ</span> Salvar Configura√ß√µes
                </button>
                <button id="testConnectionBtn" class="btn">
                    <span>üîó</span> Testar Conex√£o
                </button>
            </div>

            <!-- Configura√ß√µes Anti-Banimento Melhoradas -->
            <div class="card slide-up">
                <h2>üõ°Ô∏è Prote√ß√£o Anti-Banimento</h2>
                <div class="anti-ban-settings">
                    <h3>‚ö†Ô∏è Configura√ß√µes de Seguran√ßa Avan√ßadas</h3>
                    <p style="margin-bottom: 20px; color: #666;">
                        Configure os delays para evitar bloqueios do WhatsApp
                    </p>
                    <div class="settings-grid">
                        <div class="form-group">
                            <label class="tooltip" data-tooltip="Tempo de espera entre grupos">
                                Delay entre grupos (seg):
                            </label>
                            <input type="range" id="delayBetweenGroups" value="5" min="1" max="60" 
                                   oninput="document.getElementById('delayGroupsValue').textContent = this.value">
                            <div>Valor: <span id="delayGroupsValue">5</span>s</div>
                        </div>
                        <div class="form-group">
                            <label class="tooltip" data-tooltip="Tempo de espera entre mensagens">
                                Delay entre mensagens (seg):
                            </label>
                            <input type="range" id="delayBetweenMessages" value="2" min="1" max="30"
                                   oninput="document.getElementById('delayMessagesValue').textContent = this.value">
                            <div>Valor: <span id="delayMessagesValue">2</span>s</div>
                        </div>
                        <div class="form-group">
                            <label class="tooltip" data-tooltip="M√°ximo de grupos por lote">
                                Max grupos por lote:
                            </label>
                            <input type="number" id="maxGroupsPerBatch" value="10" min="1" max="50">
                        </div>
                        <div class="form-group">
                            <label class="tooltip" data-tooltip="Pausa entre lotes de grupos">
                                Delay entre lotes (seg):
                            </label>
                            <input type="number" id="batchDelay" value="30" min="10" max="300">
                        </div>
                    </div>
                    <button id="saveAntibanBtn" class="btn btn-warning btn-large">
                        <span>üõ°Ô∏è</span> Salvar Prote√ß√µes
                    </button>
                </div>
            </div>
        </div>

        <!-- Estat√≠sticas -->
        <div class="grid-3">
            <div class="stats-card">
                <div class="stats-number" id="totalGroups">0</div>
                <div class="stats-label">Grupos Conectados</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="totalSchedules">0</div>
                <div class="stats-label">Agendamentos Ativos</div>
            </div>
            <div class="stats-card">
                <div class="stats-number" id="totalSent">0</div>
                <div class="stats-label">V√≠deos Enviados</div>
            </div>
        </div>

        <!-- Grupos WhatsApp Melhorado -->
        <div class="card slide-up">
            <h2>üë• Grupos WhatsApp</h2>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button id="refreshGroupsBtn" class="btn">
                    <span>üîÑ</span> Atualizar Grupos
                </button>
                <button id="sendNowBtn" class="btn btn-success btn-large">
                    <span>üöÄ</span> Enviar Agora
                </button>
                <button id="selectAllBtn" class="btn">
                    <span>‚úÖ</span> Selecionar Todos
                </button>
                <button id="deselectAllBtn" class="btn">
                    <span>‚ùå</span> Desmarcar Todos
                </button>
            </div>

            <div class="progress-bar">
                <div id="sendProgress" class="progress-fill"></div>
            </div>
            
            <div id="groupsList" class="groups-list">
                <p>Conecte o bot para ver os grupos...</p>
            </div>
        </div>

        <!-- Agendamentos Melhorados -->
        <div class="card slide-up">
            <h2>‚è∞ Agendamentos Autom√°ticos</h2>
            
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button id="addScheduleModalBtn" class="btn btn-success btn-large">
                    <span>‚ûï</span> Novo Agendamento
                </button>
                <button id="importScheduleBtn" class="btn">
                    <span>üì•</span> Importar
                </button>
                <button id="exportScheduleBtn" class="btn">
                    <span>üì§</span> Exportar
                </button>
            </div>
            
            <div id="schedulesList">
                <div style="text-align: center; padding: 40px; color: #666;">
                    <span style="font-size: 3em;">üìÖ</span>
                    <p>Nenhum agendamento configurado ainda</p>
                    <p><small>Clique em "Novo Agendamento" para come√ßar</small></p>
                </div>
            </div>
        </div>

        <!-- Logs Melhorados -->
        <div class="card slide-up">
            <h2>üìä Logs em Tempo Real</h2>
            <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                <button id="clearLogsBtn" class="btn btn-warning">
                    <span>üóëÔ∏è</span> Limpar Logs
                </button>
                <button id="exportLogsBtn" class="btn">
                    <span>üíæ</span> Exportar Logs
                </button>
                <button id="pauseLogsBtn" class="btn">
                    <span>‚è∏Ô∏è</span> Pausar
                </button>
            </div>
            <div id="logsContainer" class="logs-container">
                <div class="log-entry log-info">
                    <strong>[Sistema]</strong> Auto Disparador iniciado com sucesso! üöÄ
                </div>
            </div>
        </div>
    </div>

    <!-- Footer com Cr√©ditos -->
    <footer style="background: var(--dark-color); color: white; padding: 40px 20px; margin-top: 50px;">
        <div style="max-width: 1400px; margin: 0 auto; text-align: center;">
            <div style="margin-bottom: 30px;">
                <h3 style="color: var(--primary-color); margin-bottom: 15px; font-size: 1.5em;">
                    üöÄ Auto Disparador
                </h3>
                <p style="margin-bottom: 10px; font-size: 1.1em;">
                    Sistema Avan√ßado de Automa√ß√£o para WhatsApp
                </p>
                <p style="opacity: 0.8;">
                    ‚ú® <em>"Voc√™ sonha, Deus realiza"</em> ‚ú®
                </p>
            </div>

            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 30px; margin-bottom: 20px;">
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 30px; text-align: left;">
                    <div>
                        <h4 style="color: var(--success-color); margin-bottom: 15px;">
                            üë®‚Äçüíª Desenvolvedor
                        </h4>
                        <p style="margin: 8px 0;"><strong>Wallysson Studio Dv</strong></p>
                        <p style="margin: 8px 0; opacity: 0.8;">Especialista em Automa√ß√£o</p>
                        <p style="margin: 8px 0; opacity: 0.8;">¬© 2025 - Todos os direitos reservados</p>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--info-color); margin-bottom: 15px;">
                            üìû Contatos
                        </h4>
                        <p style="margin: 8px 0;">üìß wallyssonstudio@gmail.com</p>
                        <p style="margin: 8px 0;">üåê wallyssonstudio.dev</p>
                        <p style="margin: 8px 0;">üì± WhatsApp: (85) 9999-9999</p>
                    </div>
                    
                    <div>
                        <h4 style="color: var(--warning-color); margin-bottom: 15px;">
                            üéØ Recursos
                        </h4>
                        <p style="margin: 8px 0;">‚ö° Automa√ß√£o Completa</p>
                        <p style="margin: 8px 0;">üõ°Ô∏è Sistema Anti-Ban</p>
                        <p style="margin: 8px 0;">üìä Logs em Tempo Real</p>
                        <p style="margin: 8px 0;">‚è∞ Agendamentos Inteligentes</p>
                    </div>
                </div>
            </div>

            <div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px;">
                <p style="margin: 0; opacity: 0.6; font-size: 0.9em;">
                    Desenvolvido com üíú por <strong style="color: var(--primary-color);">Wallysson Studio Dv</strong> - 
                    Transformando ideias em solu√ß√µes digitais desde 2025
                </p>
            </div>
        </div>
    </footer>

    <!-- Modal para Novo Agendamento Melhorado -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>üìÖ Configurar Agendamento</h2>
            
            <div class="form-group">
                <label>Nome do Agendamento:</label>
                <input type="text" id="scheduleName" placeholder="Ex: Envio Matinal" maxlength="50">
            </div>
            
            <div class="form-group">
                <label>Descri√ß√£o (opcional):</label>
                <input type="text" id="scheduleDescription" placeholder="Descreva este agendamento" maxlength="100">
            </div>
            
            <div class="grid-3">
                <div class="form-group">
                    <label>Hora:</label>
                    <input type="time" id="scheduleTime">
                </div>
                <div class="form-group">
                    <label>Fuso Hor√°rio:</label>
                    <select id="scheduleTimezone">
                        <option value="America/Sao_Paulo">Bras√≠lia (UTC-3)</option>
                        <option value="America/New_York">New York (UTC-5)</option>
                        <option value="Europe/London">Londres (UTC+0)</option>
                        <option value="Asia/Tokyo">T√≥quio (UTC+9)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Repetir por (dias):</label>
                    <input type="number" id="scheduleRepeatDays" value="0" min="0" max="365" 
                           placeholder="0 = infinito">
                </div>
            </div>
            
            <div class="form-group">
                <label>Dias da Semana:</label>
                <div class="days-selector">
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay0" value="0">
                        <label for="modalDay0">Domingo</label>
                    </div>
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay1" value="1">
                        <label for="modalDay1">Segunda</label>
                    </div>
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay2" value="2">
                        <label for="modalDay2">Ter√ßa</label>
                    </div>
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay3" value="3">
                        <label for="modalDay3">Quarta</label>
                    </div>
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay4" value="4">
                        <label for="modalDay4">Quinta</label>
                    </div>
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay5" value="5">
                        <label for="modalDay5">Sexta</label>
                    </div>
                    <div class="day-checkbox">
                        <input type="checkbox" id="modalDay6" value="6">
                        <label for="modalDay6">S√°bado</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Filtros Avan√ßados:</label>
                <div class="grid-3">
                    <div>
                        <label><input type="checkbox" id="onlyActiveGroups"> Apenas grupos ativos</label>
                    </div>
                    <div>
                        <label><input type="checkbox" id="minParticipants"> Min. participantes:</label>
                        <input type="number" id="minParticipantsCount" value="10" min="1" max="1000">
                    </div>
                    <div>
                        <label><input type="checkbox" id="excludeKeywords"> Excluir palavras-chave:</label>
                        <input type="text" id="excludeKeywordsList" placeholder="palavra1, palavra2">
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Selecionar Grupos para este Agendamento:</label>
                <div style="margin-bottom: 10px;">
                    <button type="button" class="btn btn-small" onclick="selectAllModalGroups()">
                        ‚úÖ Todos
                    </button>
                    <button type="button" class="btn btn-small" onclick="deselectAllModalGroups()">
                        ‚ùå Nenhum
                    </button>
                    <button type="button" class="btn btn-small" onclick="selectLargeGroups()">
                        üë• Grupos Grandes
                    </button>
                </div>
                <div id="modalGroupsList" class="groups-list">
                    <p>Carregue os grupos primeiro...</p>
                </div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button id="saveScheduleBtn" class="btn btn-success btn-large">
                    <span>üíæ</span> Salvar Agendamento
                </button>
                <button id="cancelScheduleBtn" class="btn btn-danger">
                    <span>‚ùå</span> Cancelar
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Confirma√ß√£o -->
    <div id="confirmModal" class="modal">
        <div class="modal-content" style="max-width: 400px; text-align: center;">
            <h3 id="confirmTitle">Confirmar A√ß√£o</h3>
            <p id="confirmMessage">Tem certeza que deseja continuar?</p>
            <div style="margin-top: 20px;">
                <button id="confirmYes" class="btn btn-success">Sim</button>
                <button id="confirmNo" class="btn btn-danger">N√£o</button>
            </div>
        </div>
    </div>

    <!-- Toast para Notifica√ß√µes -->
    <div id="toast" class="toast hidden">
        <span id="toastMessage"></span>
    </div>

    <script>
        // Vari√°veis globais melhoradas
        const socket = io();
        let currentConfig = {};
        let currentGroups = [];
        let editingScheduleId = null;
        let logsPaused = false;
        let totalSentMessages = 0;

        // Elementos DOM
        const statusIndicator = document.getElementById('statusIndicator');
        const statusIcon = document.getElementById('statusIcon');
        const statusText = document.getElementById('statusText');
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const clearSessionBtn = document.getElementById('clearSessionBtn');
        const qrContainer = document.getElementById('qrContainer');
        const qrCode = document.getElementById('qrCode');
        
        // Configura√ß√µes
        const youtubeApiKey = document.getElementById('youtubeApiKey');
        const channelId = document.getElementById('channelId');
        const saveConfigBtn = document.getElementById('saveConfigBtn');
        const testConnectionBtn = document.getElementById('testConnectionBtn');
        const saveAntibanBtn = document.getElementById('saveAntibanBtn');
        
        // Grupos
        const refreshGroupsBtn = document.getElementById('refreshGroupsBtn');
        const sendNowBtn = document.getElementById('sendNowBtn');
        const selectAllBtn = document.getElementById('selectAllBtn');
        const deselectAllBtn = document.getElementById('deselectAllBtn');
        const groupsList = document.getElementById('groupsList');
        const sendProgress = document.getElementById('sendProgress');
        
        // Logs
        const logsContainer = document.getElementById('logsContainer');
        const clearLogsBtn = document.getElementById('clearLogsBtn');
        const exportLogsBtn = document.getElementById('exportLogsBtn');
        const pauseLogsBtn = document.getElementById('pauseLogsBtn');
        
        // Agendamentos
        const addScheduleModalBtn = document.getElementById('addScheduleModalBtn');
        const importScheduleBtn = document.getElementById('importScheduleBtn');
        const exportScheduleBtn = document.getElementById('exportScheduleBtn');
        const schedulesList = document.getElementById('schedulesList');
        const scheduleModal = document.getElementById('scheduleModal');
        const modalGroupsList = document.getElementById('modalGroupsList');
        
        // Estat√≠sticas
        const totalGroups = document.getElementById('totalGroups');
        const totalSchedules = document.getElementById('totalSchedules');
        const totalSent = document.getElementById('totalSent');
        
        // Modal de confirma√ß√£o
        const confirmModal = document.getElementById('confirmModal');
        const toast = document.getElementById('toast');

        // Socket events melhorados
        socket.on('connect', () => {
            showToast('Conectado ao servidor com sucesso!', 'success');
            addLog('üîó Conectado ao servidor', 'success');
            loadConfig();
            updateConnectionStatus(false);
        });

        socket.on('disconnect', () => {
            showToast('Desconectado do servidor', 'error');
            addLog('‚ùå Desconectado do servidor', 'error');
            updateConnectionStatus(false);
        });

        socket.on('botStatus', (data) => {
            updateConnectionStatus(data.connected);
            if (data.connected) {
                showToast('Bot conectado ao WhatsApp!', 'success');
            }
        });

        socket.on('qrCode', (qrDataUrl) => {
            if (qrDataUrl) {
                qrCode.src = qrDataUrl;
                qrContainer.classList.remove('hidden');
                addLog('üì± QR Code gerado - escaneie com seu WhatsApp', 'info');
                showToast('QR Code gerado! Escaneie com seu WhatsApp', 'info');
            } else {
                qrContainer.classList.add('hidden');
            }
        });

        socket.on('groupsList', (groups) => {
            currentGroups = groups;
            renderGroups(groups);
            renderModalGroups(groups);
            updateStats();
            addLog(`üì± ${groups.length} grupos carregados`, 'success');
        });

        socket.on('log', (logData) => {
            if (!logsPaused) {
                addLog(logData.message, logData.type);
            }
        });

        socket.on('initResult', (result) => {
            if (result.success) {
                addLog('ü§ñ Bot inicializado com sucesso', 'success');
                showToast('Bot inicializado!', 'success');
            } else {
                addLog('‚ùå Erro ao inicializar bot: ' + result.error, 'error');
                showToast('Erro ao inicializar bot', 'error');
            }
        });

        socket.on('disconnectResult', (result) => {
            if (result.success) {
                addLog('üîå Bot desconectado com sucesso', 'success');
                updateConnectionStatus(false);
                showToast('Bot desconectado!', 'info');
            } else {
                addLog('‚ùå Erro ao desconectar: ' + result.error, 'error');
                showToast('Erro ao desconectar', 'error');
            }
        });

        socket.on('clearSessionResult', (result) => {
            if (result.success) {
                addLog('üóëÔ∏è Sess√£o limpa com sucesso', 'success');
                updateConnectionStatus(false);
                showToast('Sess√£o limpa!', 'success');
            } else {
                addLog('‚ùå Erro ao limpar sess√£o: ' + result.error, 'error');
                showToast('Erro ao limpar sess√£o', 'error');
            }
        });

        socket.on('sendResult', (result) => {
            if (result.success) {
                totalSentMessages++;
                updateStats();
                addLog('‚úÖ V√≠deo enviado com sucesso!', 'success');
                showToast('V√≠deo enviado!', 'success');
            } else {
                addLog('‚ùå Erro ao enviar v√≠deo: ' + result.error, 'error');
                showToast('Erro ao enviar v√≠deo', 'error');
            }
        });

        socket.on('sendProgress', (progress) => {
            updateSendProgress(progress);
        });

        // Event listeners melhorados
        connectBtn.addEventListener('click', () => {
            showLoading('Conectando bot...');
            socket.emit('initBot');
            addLog('üîÑ Iniciando bot...', 'info');
        });

        disconnectBtn.addEventListener('click', () => {
            confirmAction('Desconectar Bot', 'Tem certeza que deseja desconectar o bot?', () => {
                socket.emit('disconnectBot');
                addLog('üîÑ Desconectando bot...', 'info');
            });
        });

        clearSessionBtn.addEventListener('click', () => {
            confirmAction('Limpar Sess√£o', 'Tem certeza que deseja limpar a sess√£o? Voc√™ precisar√° escanear o QR code novamente.', () => {
                socket.emit('clearSession');
                addLog('üîÑ Limpando sess√£o...', 'info');
            });
        });

        saveConfigBtn.addEventListener('click', saveConfig);
        testConnectionBtn.addEventListener('click', testYouTubeConnection);
        saveAntibanBtn.addEventListener('click', saveAntiBanSettings);

        refreshGroupsBtn.addEventListener('click', () => {
            socket.emit('getGroups');
            addLog('üîÑ Atualizando lista de grupos...', 'info');
            showToast('Atualizando grupos...', 'info');
        });

        sendNowBtn.addEventListener('click', () => {
            const selectedGroups = getSelectedGroups();
            if (selectedGroups.length === 0) {
                showToast('Selecione pelo menos um grupo', 'warning');
                return;
            }
            
            confirmAction('Enviar Agora', `Enviar v√≠deo para ${selectedGroups.length} grupos?`, () => {
                socket.emit('sendVideoNow', selectedGroups);
                addLog(`üöÄ Enviando v√≠deo para ${selectedGroups.length} grupos...`, 'info');
                showToast('Iniciando envio...', 'info');
            });
        });

        selectAllBtn.addEventListener('click', () => {
            const checkboxes = groupsList.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            showToast(`${checkboxes.length} grupos selecionados`, 'info');
        });

        deselectAllBtn.addEventListener('click', () => {
            const checkboxes = groupsList.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            showToast('Todos os grupos desmarcados', 'info');
        });

        addScheduleModalBtn.addEventListener('click', () => {
            editingScheduleId = null;
            clearScheduleForm();
            renderModalGroups(currentGroups);
            scheduleModal.style.display = 'block';
        });

        importScheduleBtn.addEventListener('click', importSchedules);
        exportScheduleBtn.addEventListener('click', exportSchedules);

        clearLogsBtn.addEventListener('click', () => {
            confirmAction('Limpar Logs', 'Tem certeza que deseja limpar todos os logs?', () => {
                logsContainer.innerHTML = '<div class="log-entry log-info"><strong>[Sistema]</strong> Logs limpos pelo usu√°rio üóëÔ∏è</div>';
                showToast('Logs limpos!', 'info');
            });
        });

        exportLogsBtn.addEventListener('click', exportLogs);

        pauseLogsBtn.addEventListener('click', () => {
            logsPaused = !logsPaused;
            pauseLogsBtn.innerHTML = logsPaused ? '<span>‚ñ∂Ô∏è</span> Retomar' : '<span>‚è∏Ô∏è</span> Pausar';
            showToast(logsPaused ? 'Logs pausados' : 'Logs retomados', 'info');
        });

        // Modal events
        document.querySelector('.close').addEventListener('click', () => {
            scheduleModal.style.display = 'none';
        });

        document.getElementById('saveScheduleBtn').addEventListener('click', saveSchedule);
        document.getElementById('cancelScheduleBtn').addEventListener('click', () => {
            scheduleModal.style.display = 'none';
        });

        // Confirmation modal events
        document.getElementById('confirmYes').addEventListener('click', () => {
            if (window.confirmCallback) {
                window.confirmCallback();
                window.confirmCallback = null;
            }
            confirmModal.style.display = 'none';
        });

        document.getElementById('confirmNo').addEventListener('click', () => {
            window.confirmCallback = null;
            confirmModal.style.display = 'none';
        });

        // Fechar modals clicando fora
        window.addEventListener('click', (event) => {
            if (event.target === scheduleModal) {
                scheduleModal.style.display = 'none';
            }
            if (event.target === confirmModal) {
                confirmModal.style.display = 'none';
                window.confirmCallback = null;
            }
        });

        // Fun√ß√µes melhoradas
        function updateConnectionStatus(connected) {
            if (connected) {
                statusIndicator.textContent = 'Conectado';
                statusIndicator.className = 'status-indicator status-connected';
                statusIcon.className = 'status-icon connected';
                statusText.textContent = 'Conectado';
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                qrContainer.classList.add('hidden');
            } else {
                statusIndicator.textContent = 'Desconectado';
                statusIndicator.className = 'status-indicator status-disconnected';
                statusIcon.className = 'status-icon disconnected';
                statusText.textContent = 'Desconectado';
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
            }
            hideLoading();
        }

        function addLog(message, type = 'info') {
            if (logsPaused) return;
            
            const timestamp = new Date().toLocaleString('pt-BR');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            logsContainer.appendChild(logEntry);
            logsContainer.scrollTop = logsContainer.scrollHeight;

            // Manter apenas os √∫ltimos 200 logs
            const logs = logsContainer.children;
            if (logs.length > 200) {
                logsContainer.removeChild(logs[0]);
            }
        }

        function showToast(message, type = 'info') {
            const toastEl = document.getElementById('toast');
            const messageEl = document.getElementById('toastMessage');
            
            messageEl.textContent = message;
            toastEl.className = `toast ${type}`;
            toastEl.classList.remove('hidden');
            
            setTimeout(() => {
                toastEl.classList.add('hidden');
            }, 3000);
        }

        function showLoading(message = 'Carregando...') {
            let overlay = document.querySelector('.loading-overlay');
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.className = 'loading-overlay';
                overlay.innerHTML = `
                    <div style="text-align: center; color: white;">
                        <div class="loading-spinner"></div>
                        <p style="margin-top: 20px;">${message}</p>
                    </div>
                `;
                document.body.appendChild(overlay);
            }
        }

        function hideLoading() {
            const overlay = document.querySelector('.loading-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        function confirmAction(title, message, callback) {
            document.getElementById('confirmTitle').textContent = title;
            document.getElementById('confirmMessage').textContent = message;
            window.confirmCallback = callback;
            confirmModal.style.display = 'block';
        }

        function updateSendProgress(progress) {
            sendProgress.style.width = progress + '%';
            if (progress === 100) {
                setTimeout(() => {
                    sendProgress.style.width = '0%';
                }, 2000);
            }
        }

        function updateStats() {
            totalGroups.textContent = currentGroups.length;
            totalSchedules.textContent = currentConfig.schedules ? currentConfig.schedules.filter(s => s.active).length : 0;
            totalSent.textContent = totalSentMessages;
        }

        function renderGroups(groups) {
            if (groups.length === 0) {
                groupsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <span style="font-size: 3em;">üë•</span>
                        <p>Nenhum grupo encontrado</p>
                        <p><small>Conecte o bot e atualize a lista</small></p>
                    </div>
                `;
                return;
            }

            const html = groups.map(group => `
                <div class="group-item">
                    <input type="checkbox" id="group_${group.id}" value="${group.id}">
                    <label for="group_${group.id}">
                        <strong>${group.name}</strong><br>
                        <small>üë• ${group.participants} participantes</small>
                    </label>
                </div>
            `).join('');

            groupsList.innerHTML = html;
        }

        function renderModalGroups(groups) {
            if (groups.length === 0) {
                modalGroupsList.innerHTML = `
                    <div style="text-align: center; padding: 20px; color: #666;">
                        <p>Nenhum grupo encontrado</p>
                        <small>Conecte o bot primeiro</small>
                    </div>
                `;
                return;
            }

            const html = groups.map(group => `
                <div class="group-item">
                    <input type="checkbox" id="modalGroup_${group.id}" value="${group.id}">
                    <label for="modalGroup_${group.id}">
                        <strong>${group.name}</strong><br>
                        <small>üë• ${group.participants} participantes</small>
                    </label>
                </div>
            `).join('');

            modalGroupsList.innerHTML = html;
        }

        function getSelectedGroups() {
            const checkboxes = groupsList.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function getModalSelectedGroups() {
            const checkboxes = modalGroupsList.querySelectorAll('input[type="checkbox"]:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        // Fun√ß√µes para modal de grupos
        function selectAllModalGroups() {
            const checkboxes = modalGroupsList.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = true);
            showToast(`${checkboxes.length} grupos selecionados`, 'info');
        }

        function deselectAllModalGroups() {
            const checkboxes = modalGroupsList.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(cb => cb.checked = false);
            showToast('Todos os grupos desmarcados', 'info');
        }

        function selectLargeGroups() {
            const checkboxes = modalGroupsList.querySelectorAll('input[type="checkbox"]');
            let count = 0;
            checkboxes.forEach(cb => {
                const groupId = cb.value;
                const group = currentGroups.find(g => g.id === groupId);
                if (group && group.participants >= 50) {
                    cb.checked = true;
                    count++;
                }
            });
            showToast(`${count} grupos grandes selecionados`, 'info');
        }

        async function loadConfig() {
            try {
                const response = await fetch('/api/config');
                currentConfig = await response.json();
                
                youtubeApiKey.value = currentConfig.youtubeApiKey || '';
                channelId.value = currentConfig.channelId || '';
                
                // Carregar configura√ß√µes anti-ban
                if (currentConfig.antiBanSettings) {
                    document.getElementById('delayBetweenGroups').value = currentConfig.antiBanSettings.delayBetweenGroups || 5;
                    document.getElementById('delayGroupsValue').textContent = currentConfig.antiBanSettings.delayBetweenGroups || 5;
                    document.getElementById('delayBetweenMessages').value = currentConfig.antiBanSettings.delayBetweenMessages || 2;
                    document.getElementById('delayMessagesValue').textContent = currentConfig.antiBanSettings.delayBetweenMessages || 2;
                    document.getElementById('maxGroupsPerBatch').value = currentConfig.antiBanSettings.maxGroupsPerBatch || 10;
                    document.getElementById('batchDelay').value = currentConfig.antiBanSettings.batchDelay || 30;
                }
                
                renderSchedules();
                updateStats();
                addLog('‚öôÔ∏è Configura√ß√µes carregadas', 'info');
            } catch (error) {
                addLog('‚ùå Erro ao carregar configura√ß√µes: ' + error.message, 'error');
            }
        }

        async function saveConfig() {
            try {
                const config = {
                    ...currentConfig,
                    youtubeApiKey: youtubeApiKey.value,
                    channelId: channelId.value
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                const result = await response.json();
                
                if (result.success) {
                    currentConfig = config;
                    addLog('üíæ Configura√ß√µes salvas com sucesso', 'success');
                    showToast('Configura√ß√µes salvas!', 'success');
                } else {
                    addLog('‚ùå Erro ao salvar configura√ß√µes', 'error');
                    showToast('Erro ao salvar configura√ß√µes', 'error');
                }
            } catch (error) {
                addLog('‚ùå Erro ao salvar configura√ß√µes: ' + error.message, 'error');
                showToast('Erro ao salvar configura√ß√µes', 'error');
            }
        }

        async function testYouTubeConnection() {
            if (!youtubeApiKey.value || !channelId.value) {
                showToast('Preencha a API Key e ID do canal primeiro', 'warning');
                return;
            }

            showLoading('Testando conex√£o...');
            
            try {
                // Simular teste de conex√£o
                await new Promise(resolve => setTimeout(resolve, 2000));
                addLog('‚úÖ Conex√£o com YouTube testada com sucesso', 'success');
                showToast('Conex√£o com YouTube OK!', 'success');
            } catch (error) {
                addLog('‚ùå Erro ao testar conex√£o com YouTube', 'error');
                showToast('Erro na conex√£o com YouTube', 'error');
            } finally {
                hideLoading();
            }
        }

        async function saveAntiBanSettings() {
            try {
                const antiBanSettings = {
                    delayBetweenGroups: parseInt(document.getElementById('delayBetweenGroups').value),
                    delayBetweenMessages: parseInt(document.getElementById('delayBetweenMessages').value),
                    maxGroupsPerBatch: parseInt(document.getElementById('maxGroupsPerBatch').value),
                    batchDelay: parseInt(document.getElementById('batchDelay').value)
                };

                const config = {
                    ...currentConfig,
                    antiBanSettings
                };

                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                const result = await response.json();
                
                if (result.success) {
                    currentConfig = config;
                    addLog('üõ°Ô∏è Configura√ß√µes anti-banimento salvas', 'success');
                    showToast('Prote√ß√µes salvas!', 'success');
                } else {
                    addLog('‚ùå Erro ao salvar configura√ß√µes anti-banimento', 'error');
                    showToast('Erro ao salvar prote√ß√µes', 'error');
                }
            } catch (error) {
                addLog('‚ùå Erro ao salvar configura√ß√µes: ' + error.message, 'error');
                showToast('Erro ao salvar', 'error');
            }
        }

        function saveSchedule() {
            const name = document.getElementById('scheduleName').value;
            const description = document.getElementById('scheduleDescription').value;
            const time = document.getElementById('scheduleTime').value;
            const timezone = document.getElementById('scheduleTimezone').value;
            const repeatDays = parseInt(document.getElementById('scheduleRepeatDays').value);
            
            if (!name || !time) {
                showToast('Preencha nome e hor√°rio do agendamento', 'warning');
                return;
            }

            const selectedDays = [];
            for (let i = 0; i <= 6; i++) {
                if (document.getElementById(`modalDay${i}`).checked) {
                    selectedDays.push(i);
                }
            }

            if (selectedDays.length === 0) {
                showToast('Selecione pelo menos um dia da semana', 'warning');
                return;
            }

            const selectedGroups = getModalSelectedGroups();
            if (selectedGroups.length === 0) {
                showToast('Selecione pelo menos um grupo para este agendamento', 'warning');
                return;
            }

            const [hour, minute] = time.split(':');
            
            const schedule = {
                id: editingScheduleId || Date.now(),
                name,
                description,
                hour: parseInt(hour),
                minute: parseInt(minute),
                timezone,
                repeatDays,
                days: selectedDays,
                selectedGroups: selectedGroups,
                active: true,
                createdAt: editingScheduleId ? undefined : new Date().toISOString(),
                filters: {
                    onlyActiveGroups: document.getElementById('onlyActiveGroups').checked,
                    minParticipants: document.getElementById('minParticipants').checked,
                    minParticipantsCount: parseInt(document.getElementById('minParticipantsCount').value),
                    excludeKeywords: document.getElementById('excludeKeywords').checked,
                    excludeKeywordsList: document.getElementById('excludeKeywordsList').value
                }
            };

            if (!currentConfig.schedules) {
                currentConfig.schedules = [];
            }

            if (editingScheduleId) {
                // Editar agendamento existente
                const index = currentConfig.schedules.findIndex(s => s.id === editingScheduleId);
                if (index !== -1) {
                    currentConfig.schedules[index] = { ...currentConfig.schedules[index], ...schedule };
                    addLog(`üìÖ Agendamento "${name}" atualizado`, 'success');
                    showToast('Agendamento atualizado!', 'success');
                }
            } else {
                // Novo agendamento
                currentConfig.schedules.push(schedule);
                addLog(`üìÖ Agendamento "${name}" criado`, 'success');
                showToast('Agendamento criado!', 'success');
            }

            saveSchedules();
            renderSchedules();
            scheduleModal.style.display = 'none';
        }

        function editSchedule(id) {
            const schedule = currentConfig.schedules.find(s => s.id === id);
            if (!schedule) return;

            editingScheduleId = id;
            
            // Preencher formul√°rio
            document.getElementById('scheduleName').value = schedule.name;
            document.getElementById('scheduleDescription').value = schedule.description || '';
            document.getElementById('scheduleTime').value = 
                `${schedule.hour.toString().padStart(2, '0')}:${schedule.minute.toString().padStart(2, '0')}`;
            document.getElementById('scheduleTimezone').value = schedule.timezone || 'America/Sao_Paulo';
            document.getElementById('scheduleRepeatDays').value = schedule.repeatDays || 0;
            
            // Marcar dias
            for (let i = 0; i <= 6; i++) {
                document.getElementById(`modalDay${i}`).checked = schedule.days.includes(i);
            }
            
            // Preencher filtros se existirem
            if (schedule.filters) {
                document.getElementById('onlyActiveGroups').checked = schedule.filters.onlyActiveGroups || false;
                document.getElementById('minParticipants').checked = schedule.filters.minParticipants || false;
                document.getElementById('minParticipantsCount').value = schedule.filters.minParticipantsCount || 10;
                document.getElementById('excludeKeywords').checked = schedule.filters.excludeKeywords || false;
                document.getElementById('excludeKeywordsList').value = schedule.filters.excludeKeywordsList || '';
            }
            
            // Renderizar grupos e marcar selecionados
            renderModalGroups(currentGroups);
            
            // Aguardar renderiza√ß√£o e marcar grupos
            setTimeout(() => {
                if (schedule.selectedGroups) {
                    schedule.selectedGroups.forEach(groupId => {
                        const checkbox = document.getElementById(`modalGroup_${groupId}`);
                        if (checkbox) checkbox.checked = true;
                    });
                }
            }, 100);
            
            scheduleModal.style.display = 'block';
        }

        function removeSchedule(id) {
            confirmAction('Remover Agendamento', 'Tem certeza que deseja remover este agendamento?', () => {
                currentConfig.schedules = currentConfig.schedules.filter(s => s.id !== id);
                saveSchedules();
                renderSchedules();
                addLog('üóëÔ∏è Agendamento removido', 'info');
                showToast('Agendamento removido!', 'info');
            });
        }

        function toggleSchedule(id) {
            const schedule = currentConfig.schedules.find(s => s.id === id);
            if (schedule) {
                schedule.active = !schedule.active;
                saveSchedules();
                renderSchedules();
                const status = schedule.active ? 'ativado' : 'desativado';
                addLog(`üìÖ Agendamento ${status}`, 'info');
                showToast(`Agendamento ${status}!`, 'info');
            }
        }

        async function saveSchedules() {
            try {
                const response = await fetch('/api/config', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(currentConfig)
                });

                const result = await response.json();
                if (result.success) {
                    updateStats();
                } else {
                    addLog('‚ùå Erro ao salvar agendamentos', 'error');
                }
            } catch (error) {
                addLog('‚ùå Erro ao salvar agendamentos: ' + error.message, 'error');
            }
        }

        function renderSchedules() {
            if (!currentConfig.schedules || currentConfig.schedules.length === 0) {
                schedulesList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #666;">
                        <span style="font-size: 3em;">üìÖ</span>
                        <p>Nenhum agendamento configurado ainda</p>
                        <p><small>Clique em "Novo Agendamento" para come√ßar</small></p>
                    </div>
                `;
                return;
            }

            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sab'];
            
            const html = currentConfig.schedules.map(schedule => {
                const daysText = schedule.days.map(d => dayNames[d]).join(', ');
                const timeText = `${schedule.hour.toString().padStart(2, '0')}:${schedule.minute.toString().padStart(2, '0')}`;
                const groupsCount = schedule.selectedGroups ? schedule.selectedGroups.length : 0;
                const statusIcon = schedule.active ? '‚úÖ' : '‚è∏Ô∏è';
                const statusClass = schedule.active ? 'active' : '';
                
                return `
                    <div class="schedule-item ${statusClass}">
                        <div class="schedule-header">
                            <div class="schedule-info">
                                <h3>${statusIcon} ${schedule.name}</h3>
                                ${schedule.description ? `<small>üìù ${schedule.description}</small>` : ''}
                                <small>üïê ${timeText} - üìÖ ${daysText}</small>
                                <small>üë• ${groupsCount} grupos selecionados</small>
                                ${schedule.timezone && schedule.timezone !== 'America/Sao_Paulo' ? `<small>üåç ${schedule.timezone}</small>` : ''}
                                ${schedule.repeatDays > 0 ? `<small>üîÑ Repetir por ${schedule.repeatDays} dias</small>` : ''}
                            </div>
                            <div class="schedule-actions">
                                <button class="btn btn-small" onclick="editSchedule(${schedule.id})">
                                    <span>‚úèÔ∏è</span> Editar
                                </button>
                                <button class="btn btn-small ${schedule.active ? 'btn-warning' : 'btn-success'}" onclick="toggleSchedule(${schedule.id})">
                                    <span>${schedule.active ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}</span> ${schedule.active ? 'Pausar' : 'Ativar'}
                                </button>
                                <button class="btn btn-small btn-danger" onclick="removeSchedule(${schedule.id})">
                                    <span>üóëÔ∏è</span> Remover
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            schedulesList.innerHTML = html;
        }

        function clearScheduleForm() {
            document.getElementById('scheduleName').value = '';
            document.getElementById('scheduleDescription').value = '';
            document.getElementById('scheduleTime').value = '';
            document.getElementById('scheduleTimezone').value = 'America/Sao_Paulo';
            document.getElementById('scheduleRepeatDays').value = 0;
            
            for (let i = 0; i <= 6; i++) {
                const checkbox = document.getElementById(`modalDay${i}`);
                if (checkbox) checkbox.checked = false;
            }
            
            // Limpar filtros
            document.getElementById('onlyActiveGroups').checked = false;
            document.getElementById('minParticipants').checked = false;
            document.getElementById('minParticipantsCount').value = 10;
            document.getElementById('excludeKeywords').checked = false;
            document.getElementById('excludeKeywordsList').value = '';
            
            // Limpar grupos selecionados
            const groupCheckboxes = modalGroupsList.querySelectorAll('input[type="checkbox"]');
            groupCheckboxes.forEach(cb => cb.checked = false);
        }

        function exportSchedules() {
            if (!currentConfig.schedules || currentConfig.schedules.length === 0) {
                showToast('Nenhum agendamento para exportar', 'warning');
                return;
            }

            const dataStr = JSON.stringify(currentConfig.schedules, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `agendamentos-auto-disparador-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
            
            addLog('üì§ Agendamentos exportados', 'success');
            showToast('Agendamentos exportados!', 'success');
        }

        function importSchedules() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const schedules = JSON.parse(e.target.result);
                        if (Array.isArray(schedules)) {
                            if (!currentConfig.schedules) {
                                currentConfig.schedules = [];
                            }
                            
                            // Adicionar IDs √∫nicos para evitar conflitos
                            schedules.forEach(schedule => {
                                schedule.id = Date.now() + Math.random();
                                currentConfig.schedules.push(schedule);
                            });
                            
                            saveSchedules();
                            renderSchedules();
                            addLog(`üì• ${schedules.length} agendamentos importados`, 'success');
                            showToast('Agendamentos importados!', 'success');
                        } else {
                            throw new Error('Formato inv√°lido');
                        }
                    } catch (error) {
                        addLog('‚ùå Erro ao importar agendamentos: arquivo inv√°lido', 'error');
                        showToast('Erro no arquivo importado', 'error');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function exportLogs() {
            const logs = Array.from(logsContainer.children).map(log => log.textContent).join('\n');
            const dataBlob = new Blob([logs], {type: 'text/plain'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `logs-auto-disparador-${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            URL.revokeObjectURL(url);
            
            showToast('Logs exportados!', 'success');
        }

        // Tornar fun√ß√µes globais para onclick
        window.toggleSchedule = toggleSchedule;
        window.removeSchedule = removeSchedule;
        window.editSchedule = editSchedule;
        window.selectAllModalGroups = selectAllModalGroups;
        window.deselectAllModalGroups = deselectAllModalGroups;
        window.selectLargeGroups = selectLargeGroups;

        // Inicializar
        updateConnectionStatus(false);
        addLog('üéØ Interface Auto Disparador carregada - conecte o bot para come√ßar', 'info');
        
        // Verificar se h√° atualiza√ß√µes (simulado)
        setTimeout(() => {
            addLog('‚úÖ Verifica√ß√£o de atualiza√ß√µes conclu√≠da - vers√£o mais recente instalada', 'success');
        }, 2000);

        // Fun√ß√£o para mostrar informa√ß√µes do sistema
        function showSystemInfo() {
            addLog('üìä === INFORMA√á√ïES DO SISTEMA ===', 'info');
            addLog('üè∑Ô∏è  Nome: Auto Disparador', 'info');
            addLog('üìÖ Vers√£o: 2025.1.0', 'info');
            addLog('üåü Status: Ativo e funcionando', 'success');
        }

        // Mostrar info do sistema ao carregar
        setTimeout(showSystemInfo, 3000);
        
        // Fun√ß√£o para cr√©ditos no console
        setTimeout(() => {
            console.log('%cüöÄ Auto Disparador', 'color: #667eea; font-size: 24px; font-weight: bold;');
            console.log('%cDesenvolvido por Wallysson Studio Dv 2025', 'color: #764ba2; font-size: 16px;');
            console.log('%cüíú "Voc√™ sonha, Deus realiza"', 'color: #27ae60; font-size: 14px; font-style: italic;');
        }, 1000);
    </script>
</body>
</html>