<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Painel WhatsApp Bot</title>
<style>
  body { font-family:sans-serif; background:linear-gradient(135deg,#002266,#660000); color:#fff; display:flex; justify-content:center; padding:10px; }
  .container { max-width:450px; width:100%; background:rgba(0,0,0,0.6); border-radius:15px; padding:20px; backdrop-filter:blur(10px);}
  h1,h2{margin:10px 0;}
  img#qr{width:100%; max-width:250px; display:block; margin:10px auto; border-radius:15px;}
  #groups{max-height:200px; overflow-y:auto; margin:10px 0; padding:10px; background:rgba(0,0,0,0.3); border-radius:10px;}
  #groups label{display:flex; justify-content:space-between; align-items:center; padding:5px; margin-bottom:5px; background:rgba(255,255,255,0.05); border-radius:5px; cursor:pointer;}
  #groups label:hover{background:rgba(255,255,255,0.15);}
  input[type="checkbox"]{transform:scale(1.2);}
  button,select,input[type="time"]{width:100%; padding:10px; margin:5px 0; border:none; border-radius:10px; cursor:pointer;}
  button{background:linear-gradient(90deg,#2196f3,#f44336); color:#fff; font-weight:bold;}
  button:hover{opacity:0.85;}
  .scheduler{display:flex; flex-direction:column; gap:5px; margin-top:10px; padding:10px; border-radius:10px; background:rgba(255,255,255,0.05);}
  @media(min-width:600px){.scheduler{flex-direction:row; justify-content:space-between;} .scheduler select,.scheduler input{width:48%;}}
</style>
</head>
<body>
<div class="container">
<h1>WhatsApp Bot</h1>
<h2>QR Code</h2>
<img id="qr" src="" alt="QR Code">
<h2>Grupos</h2>
<div id="groups"></div>
<button onclick="sendVideo()">Enviar último vídeo</button>
<div class="scheduler">
  <select id="day">
    <option value="0">Domingo</option>
    <option value="1">Segunda</option>
    <option value="2">Terça</option>
    <option value="3">Quarta</option>
    <option value="4">Quinta</option>
    <option value="5">Sexta</option>
    <option value="6">Sábado</option>
  </select>
  <input type="time" id="time" value="12:00">
  <button onclick="scheduleVideo()">Agendar Envio</button>
</div>
</div>

<script>
async function loadQR(){
    const res = await fetch('qr.txt'); 
    document.getElementById('qr').src = await res.text();
}
async function loadGroups(){
    const res = await fetch('/groups'); 
    const groups = await res.json();
    document.getElementById('groups').innerHTML = groups.map(g=>`
      <label><span>${g.subject||g.name}</span><input type="checkbox" value="${g.id}"></label>
    `).join('');
}
async function sendVideo(){
    const checked = [...document.querySelectorAll('#groups input:checked')].map(i=>i.value);
    if(!checked.length) return alert('Selecione algum grupo!');
    await fetch('/send-video',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({groupIds:checked})});
    alert('Vídeo enviado!');
}
async function scheduleVideo(){
    const day = document.getElementById('day').value;
    const time = document.getElementById('time').value.split(':');
    const hour=parseInt(time[0]), minute=parseInt(time[1]);
    await fetch('/schedule-video',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({day:parseInt(day),hour,minute})});
    alert(`Envio agendado para ${hour}:${minute} no dia ${day}`);
}
loadQR(); loadGroups();
setInterval(loadQR,10000);
</script>
</body>
</html>